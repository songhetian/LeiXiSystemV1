import React, { useState, useRef, useEffect, useMemo } from 'react';
import {
  ArrowLeftOutlined,
  MoreOutlined,
  SmileOutlined,
  AudioOutlined,
  PhoneOutlined,
  VideoCameraOutlined,
  PictureOutlined,
  FileOutlined,
  CameraOutlined,
  EnvironmentOutlined,
} from '@ant-design/icons';
import { tokenManager, apiGet, apiPost } from '../../utils/apiClient';
import "./BroadcastPage.css";
const BroadcastPage = () => {
  // å¹¿æ’­ç›¸å…³çŠ¶æ€
  const [broadcastTitle, setBroadcastTitle] = useState('');
  const [broadcastContent, setBroadcastContent] = useState('');
  const [selectedRecipients, setSelectedRecipients] = useState([]);
  const [searchContact, setSearchContact] = useState('');
  const [searchType, setSearchType] = useState(''); // æœç´¢ç±»å‹ï¼šéƒ¨é—¨/ä¸ªäºº/å…¨ä½“
  const [searchDepartment, setSearchDepartment] = useState(''); // éƒ¨é—¨æœç´¢

  // æ§åˆ¶æ¨¡æ€æ¡†æ˜¾ç¤º
  const [showReadByModal, setShowReadByModal] = useState(false);
  const [currentReadBy, setCurrentReadBy] = useState([]);
  const [modalTitle, setModalTitle] = useState('');

  // æ–°å¢çŠ¶æ€ç”¨äºæ§åˆ¶å‘é€æˆåŠŸæ¨¡æ€æ¡†
  const [showSuccessModal, setShowSuccessModal] = useState(false);
  const [successMessage, setSuccessMessage] = useState('');

  // çœŸå®æ•°æ®çŠ¶æ€
  const [viewableDepartments, setViewableDepartments] = useState([]);
  const [employees, setEmployees] = useState([]);
  const [loading, setLoading] = useState(true);

  // æ„å»ºè”ç³»äººæ•°æ®
  const [contacts, setContacts] = useState([]);

  // å·²é€‰ä¸­çš„è”ç³»äººï¼ˆæŒä¹…åŒ–ä¿å­˜ï¼‰
  const [savedRecipients, setSavedRecipients] = useState(() => {
    const saved = localStorage.getItem('broadcastRecipients');
    return saved ? JSON.parse(saved) : [];
  });

  // æ¶ˆæ¯å†å²ï¼ˆä»æœåŠ¡å™¨è·å–çš„çœŸå®æ•°æ®ï¼‰
  const [messages, setMessages] = useState([]);

  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // ä¿å­˜å·²é€‰è”ç³»äººåˆ°localStorage
  useEffect(() => {
    localStorage.setItem('broadcastRecipients', JSON.stringify(savedRecipients));
  }, [savedRecipients]);

  // è·å–çœŸå®æ•°æ®
  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      try {
        // ä»JWTä¸­è·å–ç”¨æˆ·ä¿¡æ¯å’Œå¯è§éƒ¨é—¨
        const token = tokenManager.getToken();
        const payload = tokenManager.parseToken(token);

        // è·å–ç”¨æˆ·å¯è§çš„éƒ¨é—¨IDs
        const viewableDeptIds = payload?.viewableDepartmentIds || [];
        console.log('ç”¨æˆ·å¯è§éƒ¨é—¨IDs:', viewableDeptIds);

        if (viewableDeptIds.length > 0) {
          // è·å–éƒ¨é—¨åˆ—è¡¨ - ä½¿ç”¨ä¸BroadcastManagement.jsxç›¸åŒçš„æ–¹å¼
          const deptsResponse = await apiGet('/api/departments');
          if (Array.isArray(deptsResponse)) {
            // è¿‡æ»¤å‡ºç”¨æˆ·å¯è§çš„éƒ¨é—¨
            const filteredDepartments = deptsResponse.filter(dept =>
              viewableDeptIds.includes(dept.id)
            );
            setViewableDepartments(filteredDepartments);
            console.log('è·å–åˆ°çš„éƒ¨é—¨ä¿¡æ¯:', filteredDepartments);
          }

          // è·å–å‘˜å·¥ä¿¡æ¯ - ä½¿ç”¨ä¸BroadcastManagement.jsxç›¸åŒçš„æ–¹å¼
          const employeesResponse = await apiGet('/api/employees');
          if (Array.isArray(employeesResponse)) {
            setEmployees(employeesResponse);
            console.log('è·å–åˆ°çš„å‘˜å·¥ä¿¡æ¯:', employeesResponse);
          }
        } else {
          // å¦‚æœæ²¡æœ‰å¯è§éƒ¨é—¨ï¼Œè·å–æ‰€æœ‰éƒ¨é—¨ï¼ˆè¿™ç§æƒ…å†µåº”è¯¥å¾ˆå°‘è§ï¼‰
          const deptsResponse = await apiGet('/api/departments');
          if (Array.isArray(deptsResponse)) {
            setViewableDepartments(deptsResponse); // æ˜¾ç¤ºæ‰€æœ‰å¯è§éƒ¨é—¨
          }
          // è·å–æ‰€æœ‰å‘˜å·¥
          const employeesResponse = await apiGet('/api/employees');
          if (Array.isArray(employeesResponse)) {
            setEmployees(employeesResponse);
          }
        }
      } catch (error) {
        console.error('è·å–æ•°æ®å¤±è´¥:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);
  // æ„å»ºè”ç³»äººæ•°æ®
  useEffect(() => {
    const contactList = [];

    // æ·»åŠ éƒ¨é—¨
    viewableDepartments.forEach(dept => {
      // è·å–è¯¥éƒ¨é—¨çš„å‘˜å·¥æ•°é‡
      const deptEmployees = employees.filter(emp => emp.department_id === dept.id);
      contactList.push({
        id: dept.id,
        name: dept.name,
        type: 'department',
        avatar: dept.name.substring(0, 1),
        members: deptEmployees.length,
        employees: deptEmployees
      });
    });

    // æ·»åŠ ä¸ªäºº
    employees.forEach(emp => {
      const dept = viewableDepartments.find(d => d.id === emp.department_id);
      contactList.push({
        id: emp.id,
        name: emp.real_name,
        type: 'individual',
        avatar: emp.real_name.substring(0, 1),
        department: dept ? dept.name : ''
      });
    });

    // æ·»åŠ å…¨ä½“æˆå‘˜
    const totalMembers = employees.length;
    if (totalMembers > 0) {
      contactList.push({
        id: 999,
        name: 'å…¨ä½“æˆå‘˜',
        type: 'all',
        avatar: 'å…¨',
        members: totalMembers,
        departments: viewableDepartments.map(d => d.name)
      });
    }

    setContacts(contactList);
  }, [viewableDepartments, employees]);

  // æ ¹æ®æœç´¢ç±»å‹å’Œå…³é”®è¯è¿‡æ»¤è”ç³»äºº
  const filteredContacts = useMemo(() => {
    if (!searchType) return [];

    let result = contacts.filter(contact => contact.type === searchType);

    // å¦‚æœæœ‰æœç´¢å…³é”®è¯ï¼Œè¿›è¡Œè¿‡æ»¤
    if (searchContact.trim()) {
      result = result.filter(contact =>
        contact.name.toLowerCase().includes(searchContact.toLowerCase())
      );
    }

    // å¦‚æœæ˜¯ä¸ªäººæœç´¢ï¼Œå¹¶ä¸”æœ‰éƒ¨é—¨ç­›é€‰
    if (searchType === 'individual' && searchDepartment.trim()) {
      result = result.filter(contact =>
        contact.department.toLowerCase().includes(searchDepartment.toLowerCase())
      );
    }

    return result;
  }, [contacts, searchContact, searchType, searchDepartment]);

  // å¤„ç†å‘é€å¹¿æ’­
  const handleSendBroadcast = async () => {
    if (!broadcastContent.trim() || selectedRecipients.length === 0) {
      // ä½¿ç”¨æ¨¡æ€æ¡†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      setSuccessMessage('è¯·å¡«å†™å¹¿æ’­å†…å®¹å¹¶é€‰æ‹©æ¥æ”¶äºº');
      setShowSuccessModal(true);
      return;
    }

    try {
      // æ„é€ å‘é€æ•°æ®
      let targetType = '';
      let targetData = null;

      if (selectedRecipients.some(r => r.type === 'all')) {
        targetType = 'all';
      } else if (selectedRecipients.some(r => r.type === 'department')) {
        targetType = 'department';
        targetData = selectedRecipients.filter(r => r.type === 'department').map(r => r.id);
      } else {
        targetType = 'individual';
        targetData = selectedRecipients.filter(r => r.type === 'individual').map(r => r.id);
      }

      const payload = {
        title: broadcastTitle || 'å¹¿æ’­æ¶ˆæ¯',
        content: broadcastContent,
        type: 'info',
        priority: 'normal',
        targetType: targetType,
        [`target${targetType.charAt(0).toUpperCase() + targetType.slice(1)}s`]: JSON.stringify(targetData)
      };

      // å‘é€å¹¿æ’­
      const response = await apiPost('/api/broadcasts', payload);

      if (response.success) {
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯æ¨¡æ€æ¡†
        setSuccessMessage(`å¹¿æ’­å‘é€æˆåŠŸï¼å·²å‘é€ç»™ ${response.data.recipientCount} äºº`);
        setShowSuccessModal(true);

        // åˆ›å»ºæœ¬åœ°æ¶ˆæ¯è®°å½•
        const newMessage = {
          id: messages.length + 1,
          type: 'sent',
          title: broadcastTitle || 'å¹¿æ’­æ¶ˆæ¯',
          content: broadcastContent,
          timestamp: new Date().toLocaleTimeString('zh-CN', {
            hour: '2-digit',
            minute: '2-digit',
          }),
          recipients: selectedRecipients.map(r => r.name).join(', '),
          readCount: 0,
          totalCount: response.data.recipientCount,
          avatar: broadcastContent.substring(0, 1),
          readBy: [] // åˆå§‹ä¸ºç©º
        };

        setMessages([...messages, newMessage]);

        // é‡ç½®è¡¨å•
        setBroadcastTitle('');
        setBroadcastContent('');
      } else {
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯æ¨¡æ€æ¡†
        setSuccessMessage('å¹¿æ’­å‘é€å¤±è´¥ï¼š' + (response.message || 'æœªçŸ¥é”™è¯¯'));
        setShowSuccessModal(true);
      }
    } catch (error) {
      console.error('å‘é€å¹¿æ’­å¤±è´¥:', error);
      // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯æ¨¡æ€æ¡†
      setSuccessMessage('å¹¿æ’­å‘é€å¤±è´¥ï¼š' + error.message);
      setShowSuccessModal(true);
    }
  };

  // åˆ‡æ¢è”ç³»äººé€‰æ‹©
  const toggleRecipient = (contact) => {
    setSelectedRecipients(prev => {
      const isSelected = prev.some(r => r.id === contact.id);
      if (isSelected) {
        return prev.filter(r => r.id !== contact.id);
      } else {
        return [...prev, contact];
      }
    });
  };

  // æ·»åŠ åˆ°å·²ä¿å­˜è”ç³»äºº
  const addToSavedRecipients = (contact) => {
    setSavedRecipients(prev => {
      const isAlreadySaved = prev.some(r => r.id === contact.id);
      if (!isAlreadySaved) {
        return [...prev, contact];
      }
      return prev;
    });
  };

  // ä»å·²ä¿å­˜è”ç³»äººä¸­ç§»é™¤
  const removeFromSavedRecipients = (contactId) => {
    setSavedRecipients(prev => prev.filter(r => r.id !== contactId));
  };

  // æ˜¾ç¤ºå·²è¯»äººå‘˜åå• - æ”¹ä¸ºæ¨¡æ€æ¡†
  const showReadByList = (readBy, title) => {
    setCurrentReadBy(readBy);
    setModalTitle(title);
    setShowReadByModal(true);
  };

  // å…³é—­æ¨¡æ€æ¡†
  const closeReadByModal = () => {
    setShowReadByModal(false);
    setCurrentReadBy([]);
    setModalTitle('');
  };

  if (loading) {
    return (
      <div className="wechat-page" style={{ height: '95vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
        <div>åŠ è½½ä¸­...</div>
      </div>
    );
  }

  return (
    <div className="wechat-page" style={{ height: '95vh' }}>
      {/* Left Sidebar - Contact List and Search */}
      <div className="wechat-sidebar" style={{ width: '300px' }}>
        {/* Search Box */}
        <div className="sidebar-search">
          {/* Type Selection Buttons - æ”¾åœ¨ç‹¬ç«‹çš„ä¸€è¡Œ */}
          <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
            <button
              onClick={() => setSearchType('department')}
              style={{
                flex: 1,
                padding: '8px 4px', // å‡å°é«˜åº¦
                backgroundColor: searchType === 'department' ? '#07c160' : '#f0f0f0',
                color: searchType === 'department' ? 'white' : '#333',
                border: 'none',
                borderRadius: '6px', // åœ†è§’
                boxShadow: '0 2px 4px rgba(0,0,0,0.1)', // é˜´å½±
                fontSize: '14px',
                cursor: 'pointer',
                transition: 'all 0.3s'
              }}
              onMouseOver={(e) => e.target.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)'}
              onMouseOut={(e) => e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)'}
            >
              éƒ¨é—¨
            </button>
            <button
              onClick={() => setSearchType('individual')}
              style={{
                flex: 1,
                padding: '8px 4px', // å‡å°é«˜åº¦
                backgroundColor: searchType === 'individual' ? '#07c160' : '#f0f0f0',
                color: searchType === 'individual' ? 'white' : '#333',
                border: 'none',
                borderRadius: '6px', // åœ†è§’
                boxShadow: '0 2px 4px rgba(0,0,0,0.1)', // é˜´å½±
                fontSize: '14px',
                cursor: 'pointer',
                transition: 'all 0.3s'
              }}
              onMouseOver={(e) => e.target.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)'}
              onMouseOut={(e) => e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)'}
            >
              ä¸ªäºº
            </button>
            <button
              onClick={() => setSearchType('all')}
              style={{
                flex: 1,
                padding: '8px 4px', // å‡å°é«˜åº¦
                backgroundColor: searchType === 'all' ? '#07c160' : '#f0f0f0',
                color: searchType === 'all' ? 'white' : '#333',
                border: 'none',
                borderRadius: '6px', // åœ†è§’
                boxShadow: '0 2px 4px rgba(0,0,0,0.1)', // é˜´å½±
                fontSize: '14px',
                cursor: 'pointer',
                transition: 'all 0.3s'
              }}
              onMouseOver={(e) => e.target.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)'}
              onMouseOut={(e) => e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)'}
            >
              å…¨ä½“
            </button>
          </div>

          {/* æœç´¢æ¡† - ç‹¬ç«‹æ”¾åœ¨ç¬¬äºŒè¡Œ */}
          <div style={{ marginBottom: '12px' }}>
            <input
              type="text"
              placeholder={`æœç´¢${searchType === 'department' ? 'éƒ¨é—¨' : searchType === 'individual' ? 'ä¸ªäºº' : 'å…¨ä½“'}...`}
              value={searchContact}
              onChange={(e) => setSearchContact(e.target.value)}
              className="search-input"
              style={{ width: '100%', marginBottom: '8px' }}
            />

            {/* éƒ¨é—¨æœç´¢æ¡† - ä»…åœ¨æœç´¢ä¸ªäººæ—¶æ˜¾ç¤º */}
            {searchType === 'individual' && (
              <input
                type="text"
                placeholder="æŒ‰éƒ¨é—¨ç­›é€‰..."
                value={searchDepartment}
                onChange={(e) => setSearchDepartment(e.target.value)}
                className="search-input"
                style={{ width: '100%' }}
              />
            )}
          </div>
        </div>

        {/* Saved Recipients */}
        {savedRecipients.length > 0 && (
          <div style={{ padding: '0 12px 12px 12px' }}>
            <h4 style={{ margin: '0 0 8px 0', fontSize: '14px', color: '#666' }}>å¸¸ç”¨è”ç³»äºº</h4>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
              {savedRecipients.map(recipient => (
                <div
                  key={`saved-${recipient.id}`}
                  onClick={() => toggleRecipient(recipient)}
                  style={{
                    padding: '6px 12px',
                    backgroundColor: selectedRecipients.some(r => r.id === recipient.id) ? '#07c160' : '#f0f0f0',
                    color: selectedRecipients.some(r => r.id === recipient.id) ? 'white' : '#333',
                    borderRadius: '16px',
                    fontSize: '12px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '4px',
                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                  }}
                >
                  {recipient.name}
                  <span
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFromSavedRecipients(recipient.id);
                    }}
                    style={{
                      cursor: 'pointer',
                      color: selectedRecipients.some(r => r.id === recipient.id) ? 'white' : '#ff4d4f'
                    }}
                  >
                    Ã—
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Contact List */}
        <div className="contact-list">
          {searchType ? (
            filteredContacts.length > 0 ? (
              filteredContacts.map((contact) => (
                <div
                  key={contact.id}
                  className={`contact-item ${
                    selectedRecipients.some(r => r.id === contact.id) ? 'active' : ''
                  }`}
                  onClick={() => toggleRecipient(contact)}
                  onDoubleClick={() => addToSavedRecipients(contact)}
                >
                  <div className="contact-avatar">
                    <div className="avatar-text">{contact.avatar}</div>
                  </div>
                  <div className="contact-info">
                    <div className="contact-header">
                      <span className="contact-name">{contact.name}</span>
                    </div>
                    <div className="contact-message">
                      {contact.type === 'department'
                        ? `${contact.members}åæˆå‘˜`
                        : contact.type === 'individual'
                          ? contact.department
                          : `${contact.members}åæˆå‘˜`}
                    </div>
                  </div>
                  <div style={{
                    padding: '4px 8px',
                    backgroundColor: selectedRecipients.some(r => r.id === contact.id) ? '#07c160' : '#f0f0f0',
                    color: selectedRecipients.some(r => r.id === contact.id) ? 'white' : '#333',
                    borderRadius: '4px',
                    fontSize: '12px',
                    cursor: 'pointer',
                    boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                  }}>
                    {selectedRecipients.some(r => r.id === contact.id) ? 'å·²é€‰' : 'é€‰æ‹©'}
                  </div>
                </div>
              ))
            ) : (
              <div style={{ textAlign: 'center', padding: '20px', color: '#999' }}>
                æ— åŒ¹é…çš„{searchType === 'department' ? 'éƒ¨é—¨' : searchType === 'individual' ? 'ä¸ªäºº' : 'å…¨ä½“'}ä¿¡æ¯
              </div>
            )
          ) : (
            <div style={{ textAlign: 'center', padding: '20px', color: '#999' }}>
              è¯·é€‰æ‹©æœç´¢ç±»å‹
            </div>
          )}
        </div>
      </div>

      {/* Right Side - Chat Area */}
      <div className="wechat-main">
        <div className="wechat-header">
          <div className="header-title">
            <h2>å¹¿æ’­æ¶ˆæ¯</h2>
          </div>
        </div>

        {/* Messages Area - Broadcast History */}
        <div className="wechat-messages">
          {messages.map((msg) => (
            <div key={msg.id} className={`message-wrapper ${msg.type}`} style={{ justifyContent: 'flex-end' }}>
              <div
                className={`message-bubble ${msg.type}`}
                style={{ backgroundColor: '#95ec69', color: '#000', cursor: 'pointer' }}
                onClick={() => showReadByList(msg.readBy, msg.title)}
              >
                <div style={{ fontWeight: '500', marginBottom: '4px' }}>{msg.title}</div>
                <div className="message-content" style={{ marginBottom: '8px' }}>{msg.content}</div>
                <div style={{ fontSize: '12px', color: '#666' }}>
                  å‘é€ç»™: {msg.recipients} |
                  å·²è¯»: {msg.readCount}/{msg.totalCount} |
                  æ—¶é—´: {msg.timestamp}
                </div>
                <div style={{ fontSize: '12px', color: '#666', marginTop: '4px', textDecoration: 'underline' }}>
                  ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                </div>
              </div>
              <div className="message-avatar sent">{msg.avatar}</div>
            </div>
          ))}
          <div ref={messagesEndRef} />
        </div>

        {/* Bottom Input Bar - Like WeChat (å»é™¤+æŒ‰é’®) */}
        <div className="wechat-input-bar">
          <div style={{ marginBottom: '8px' }}>
            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '4px' }}>
              {selectedRecipients.map(recipient => (
                <div
                  key={recipient.id}
                  style={{
                    display: 'inline-flex',
                    alignItems: 'center',
                    backgroundColor: '#e0e0e0',
                    padding: '2px 8px',
                    borderRadius: '12px',
                    fontSize: '12px'
                  }}
                >
                  {recipient.name}
                  <span
                    onClick={() => toggleRecipient(recipient)}
                    style={{
                      marginLeft: '4px',
                      cursor: 'pointer',
                      color: '#ff4d4f'
                    }}
                  >
                    Ã—
                  </span>
                </div>
              ))}
            </div>
            {selectedRecipients.length > 0 && (
              <div style={{ fontSize: '12px', color: '#666' }}>
                å‘é€ç»™: {selectedRecipients.map(r => r.name).join(', ')}
              </div>
            )}
          </div>

          <div className="input-controls">
            {/* å»é™¤äº†+æŒ‰é’® */}
            <div className="input-wrapper">
              <textarea
                placeholder="è¯·è¾“å…¥å¹¿æ’­å†…å®¹..."
                value={broadcastContent}
                onChange={(e) => setBroadcastContent(e.target.value)}
                onKeyDown={(e) => {
                  // Enter å‘é€ï¼ˆæ’é™¤Shift+Enteræ¢è¡Œçš„æƒ…å†µï¼‰
                  if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendBroadcast();
                  }
                }}
                className="message-input"
                style={{
                  minHeight: '30px', // è¿›ä¸€æ­¥å‡å°æœ€å°é«˜åº¦
                  resize: 'none',
                  fontFamily: 'inherit',
                  maxHeight: '80px', // å‡å°æœ€å¤§é«˜åº¦
                  overflowY: 'auto' // è¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡
                }}
              />
            </div>
            <button
              className="send-btn"
              onClick={handleSendBroadcast}
              disabled={!broadcastContent.trim() || selectedRecipients.length === 0}
            >
              å‘é€
            </button>
          </div>
        </div>
      </div>

      {/* Read By Modal - ä¼˜åŒ–æ¨¡æ€æ¡†è®¾è®¡ */}
      {showReadByModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            backgroundColor: 'white',
            borderRadius: '12px',
            padding: '24px',
            maxWidth: '500px',
            width: '90%',
            maxHeight: '80vh',
            overflow: 'hidden',
            boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)'
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '20px',
              paddingBottom: '16px',
              borderBottom: '1px solid #eee'
            }}>
              <h3 style={{ margin: 0, fontSize: '18px', color: '#333' }}>{modalTitle} - å·²è¯»äººå‘˜è¯¦æƒ…</h3>
              <button
                onClick={closeReadByModal}
                style={{
                  background: 'none',
                  border: 'none',
                  fontSize: '24px',
                  cursor: 'pointer',
                  padding: '0',
                  color: '#999',
                  width: '30px',
                  height: '30px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  borderRadius: '50%',
                  transition: 'background-color 0.3s'
                }}
                onMouseOver={(e) => e.target.style.backgroundColor = '#f5f5f5'}
                onMouseOut={(e) => e.target.style.backgroundColor = 'transparent'}
              >
                Ã—
              </button>
            </div>
            <div style={{
              maxHeight: '60vh',
              overflowY: 'auto',
              paddingRight: '8px'
            }}>
              {currentReadBy.length > 0 ? (
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fill, minmax(100px, 1fr))',
                  gap: '12px'
                }}>
                  {currentReadBy.map((name, index) => (
                    <div
                      key={index}
                      style={{
                        padding: '12px 8px',
                        backgroundColor: '#f8f9fa',
                        borderRadius: '8px',
                        textAlign: 'center',
                        fontSize: '14px',
                        color: '#333',
                        boxShadow: '0 1px 3px rgba(0,0,0,0.05)',
                        transition: 'all 0.2s'
                      }}
                      onMouseOver={(e) => e.target.style.transform = 'translateY(-2px)'}
                      onMouseOut={(e) => e.target.style.transform = 'translateY(0)'}
                    >
                      <div style={{
                        width: '40px',
                        height: '40px',
                        borderRadius: '50%',
                        backgroundColor: '#07c160',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        margin: '0 auto 8px',
                        color: 'white',
                        fontWeight: 'bold'
                      }}>
                        {name.charAt(0)}
                      </div>
                      {name}
                    </div>
                  ))}
                </div>
              ) : (
                <div style={{ textAlign: 'center', color: '#999', padding: '40px 20px' }}>
                  <div style={{ fontSize: '48px', marginBottom: '16px' }}>ğŸ“­</div>
                  <p>æš‚æ— å·²è¯»äººå‘˜</p>
                </div>
              )}
            </div>
            <div style={{ textAlign: 'center', marginTop: '24px' }}>
              <button
                onClick={closeReadByModal}
                style={{
                  padding: '10px 30px',
                  backgroundColor: '#07c160',
                  color: 'white',
                  border: 'none',
                  borderRadius: '6px',
                  cursor: 'pointer',
                  fontSize: '16px',
                  boxShadow: '0 2px 6px rgba(7, 193, 96, 0.3)',
                  transition: 'all 0.3s'
                }}
                onMouseOver={(e) => {
                  e.target.style.backgroundColor = '#06b054';
                  e.target.style.boxShadow = '0 4px 12px rgba(7, 193, 96, 0.4)';
                }}
                onMouseOut={(e) => {
                  e.target.style.backgroundColor = '#07c160';
                  e.target.style.boxShadow = '0 2px 6px rgba(7, 193, 96, 0.3)';
                }}
              >
                å…³é—­
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Success Message Modal - å‘é€æˆåŠŸæç¤ºæ¨¡æ€æ¡† */}
      {showSuccessModal && (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.5)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000
        }}>
          <div style={{
            backgroundColor: 'white',
            borderRadius: '12px',
            padding: '30px',
            maxWidth: '400px',
            width: '90%',
            textAlign: 'center',
            boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)'
          }}>
            <div style={{
              width: '60px',
              height: '60px',
              borderRadius: '50%',
              backgroundColor: '#07c160',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              margin: '0 auto 20px',
              color: 'white',
              fontSize: '30px'
            }}>
              âœ“
            </div>
            <h3 style={{
              margin: '0 0 15px 0',
              fontSize: '20px',
              color: '#333',
              fontWeight: '500'
            }}>
              æç¤º
            </h3>
            <p style={{
              margin: '0 0 25px 0',
              fontSize: '16px',
              color: '#666',
              lineHeight: '1.5'
            }}>
              {successMessage}
            </p>
            <button
              onClick={() => setShowSuccessModal(false)}
              style={{
                padding: '12px 30px',
                backgroundColor: '#07c160',
                color: 'white',
                border: 'none',
                borderRadius: '6px',
                cursor: 'pointer',
                fontSize: '16px',
                fontWeight: '500',
                boxShadow: '0 2px 6px rgba(7, 193, 96, 0.3)',
                transition: 'all 0.3s'
              }}
              onMouseOver={(e) => {
                e.target.style.backgroundColor = '#06b054';
                e.target.style.boxShadow = '0 4px 12px rgba(7, 193, 96, 0.4)';
              }}
              onMouseOut={(e) => {
                e.target.style.backgroundColor = '#07c160';
                e.target.style.boxShadow = '0 2px 6px rgba(7, 193, 96, 0.3)';
              }}
            >
              ç¡®å®š
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

export default BroadcastPage;
