# å®¢æœç®¡ç†ç³»ç»Ÿéƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### ç³»ç»Ÿè¦æ±‚

#### æœåŠ¡å™¨è¦æ±‚
- æ“ä½œç³»ç»Ÿï¼šWindows Server 2016+/Ubuntu 18.04+/CentOS 7+
- å†…å­˜ï¼šè‡³å°‘ 4GB RAMï¼ˆæ¨è 8GB+ï¼‰
- å­˜å‚¨ç©ºé—´ï¼šè‡³å°‘ 20GB å¯ç”¨ç£ç›˜ç©ºé—´
- CPUï¼šåŒæ ¸å¤„ç†å™¨ï¼ˆæ¨èå››æ ¸+ï¼‰

#### è½¯ä»¶ä¾èµ–
- Node.js >= 16.0.0
- MySQL >= 8.0
- npm >= 8.0.0
- PowerShellï¼ˆWindowsï¼‰æˆ– Bashï¼ˆLinux/macOSï¼‰

### ç½‘ç»œè¦æ±‚
- æœåŠ¡å™¨éœ€è¦è®¿é—®äº’è”ç½‘ä»¥ä¸‹è½½ä¾èµ–åŒ…
- å®¢æˆ·ç«¯éœ€è¦èƒ½å¤Ÿè®¿é—®æœåŠ¡å™¨çš„ 3001 ç«¯å£
- å»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œä»…å…è®¸æˆæƒIPè®¿é—®

## ğŸ—„ æ•°æ®åº“é…ç½®

### MySQL å®‰è£…

#### Windows
```powershell
# ä¸‹è½½ MySQL Installer
# è¿è¡Œå®‰è£…ç¨‹åºï¼Œé€‰æ‹© Server only
# é…ç½® root å¯†ç 
# ç¡®ä¿ MySQL æœåŠ¡å·²å¯åŠ¨
```

#### Ubuntu/Debian
```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… MySQL Server
sudo apt install mysql-server

# å¯åŠ¨ MySQL æœåŠ¡
sudo systemctl start mysql

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable mysql

# è¿è¡Œå®‰å…¨é…ç½®å‘å¯¼
sudo mysql_secure_installation
```

#### CentOS/RHEL
```bash
# å®‰è£… MySQLï¼ˆMariaDBï¼‰
sudo yum install mariadb-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start mariadb

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable mariadb

# è¿è¡Œå®‰å…¨é…ç½®å‘å¯¼
sudo mysql_secure_installation
```

### æ•°æ®åº“åˆå§‹åŒ–

1. ç™»å½• MySQLï¼š
```bash
mysql -u root -p
```

2. åˆ›å»ºæ•°æ®åº“ï¼š
```sql
CREATE DATABASE customer_service_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'cs_user'@'localhost' IDENTIFIED BY 'strong_password_here';
GRANT ALL PRIVILEGES ON customer_service_db.* TO 'cs_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

## ğŸš€ ç³»ç»Ÿéƒ¨ç½²

### 1. è·å–æºä»£ç 

```bash
# å…‹éš†é¡¹ç›®ä»£ç 
git clone <repository-url>
cd customer-service-desktop

# æˆ–è€…ä¸‹è½½å‹ç¼©åŒ…å¹¶è§£å‹
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

1. å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .envexample .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å‚æ•°ï¼š
```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_USER=cs_user
DB_PASSWORD=strong_password_here
DB_NAME=customer_service_db
DB_PORT=3306

# JWT å¯†é’¥ï¼ˆè¯·æ›´æ¢ä¸ºå¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your_jwt_secret_key_here

# æœåŠ¡å™¨ç«¯å£
PORT=3001

# æ–‡ä»¶ä¸Šä¼ ç›®å½•
UPLOAD_DIR=./uploads
```

### 3. å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install
```

### 4. æ•°æ®åº“è¿ç§»

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
npm run db:migrate

# åˆå§‹åŒ–ç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰
npm run db:seed

# é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼ˆå¯é€‰ï¼‰
npm run db:reset-admin
```

### 5. æ„å»ºå‰ç«¯èµ„æº

```bash
# æ„å»ºç”Ÿäº§ç¯å¢ƒçš„å‰ç«¯èµ„æº
npm run build
```

## â–¶ï¸ å¯åŠ¨æœåŠ¡

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# åŒæ—¶å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨å’Œåç«¯æœåŠ¡
npm start
```

### ç”Ÿäº§ç¯å¢ƒå¯åŠ¨

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰

1. å®‰è£… PM2ï¼š
```bash
npm install -g pm2
```

2. å¯åŠ¨æœåŠ¡ï¼š
```bash
# å¯åŠ¨åç«¯æœåŠ¡
pm2 start server/index.js --name "customer-service-backend"

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### æ–¹æ³•äºŒï¼šç›´æ¥å¯åŠ¨

```bash
# å¯åŠ¨åç«¯æœåŠ¡
npm run prod:server
```

### æ¡Œé¢åº”ç”¨æ‰“åŒ…

#### Windows æ‰“åŒ…
```bash
# ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…
npm run package:win

# å¼€å‘ç¯å¢ƒæ‰“åŒ…ï¼ˆç”¨äºæµ‹è¯•ï¼‰
npm run package:dev:win
```

#### macOS æ‰“åŒ…
```bash
# ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…
npm run package:mac

# å¼€å‘ç¯å¢ƒæ‰“åŒ…ï¼ˆç”¨äºæµ‹è¯•ï¼‰
npm run package:dev:mac
```

#### Linux æ‰“åŒ…
```bash
# ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…
npm run package:linux

# å¼€å‘ç¯å¢ƒæ‰“åŒ…ï¼ˆç”¨äºæµ‹è¯•ï¼‰
npm run package:dev:linux
```

## âš™ï¸ ç³»ç»Ÿé…ç½®

### ç½‘ç»œé…ç½®

#### ç«¯å£é…ç½®
- åç«¯ API æœåŠ¡ï¼š3001 ç«¯å£
- å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼š5173 ç«¯å£
- Electron åº”ç”¨ï¼šå†…ç½® WebView è®¿é—®æœ¬åœ°æœåŠ¡

#### åå‘ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰

ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://localhost:3001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### å®‰å…¨é…ç½®

#### SSL è¯ä¹¦é…ç½®
å»ºè®®ä¸ºç”Ÿäº§ç¯å¢ƒé…ç½® SSL è¯ä¹¦ï¼š

```bash
# ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
sudo apt install certbot nginx
sudo certbot --nginx -d your-domain.com
```

#### é˜²ç«å¢™é…ç½®
```bash
# Ubuntu/Debian
sudo ufw allow 3001/tcp
sudo ufw allow 22/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --reload
```

### å¤‡ä»½ç­–ç•¥

#### æ•°æ®åº“å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬ backup.sh
#!/bin/bash
mysqldump -u cs_user -pstrong_password_here customer_service_db > /backup/cs_backup_$(date +%Y%m%d_%H%M%S).sql

# è®¾ç½®å®šæ—¶ä»»åŠ¡
crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /path/to/backup.sh
```

#### æ–‡ä»¶å¤‡ä»½
```bash
# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf uploads_backup_$(date +%Y%m%d_%H%M%S).tar.gz ./uploads/
```

## ğŸ”„ ç³»ç»Ÿæ›´æ–°

### æ›´æ–°æµç¨‹

1. åœæ­¢å½“å‰æœåŠ¡ï¼š
```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 stop customer-service-backend

# æˆ–è€…ç›´æ¥åœæ­¢è¿›ç¨‹
pkill -f "node server/index.js"
```

2. å¤‡ä»½å½“å‰ç‰ˆæœ¬ï¼š
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u cs_user -pstrong_password_here customer_service_db > backup_before_update.sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp .env .env.backup
```

3. è·å–æœ€æ–°ä»£ç ï¼š
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æˆ–è€…ä¸‹è½½æ–°ç‰ˆæœ¬å¹¶æ›¿æ¢æ–‡ä»¶
```

4. å®‰è£…æ–°ä¾èµ–ï¼š
```bash
npm install
```

5. æ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœ‰ï¼‰ï¼š
```bash
npm run db:migrate
```

6. é‡æ–°æ„å»ºå‰ç«¯ï¼š
```bash
npm run build
```

7. å¯åŠ¨æœåŠ¡ï¼š
```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 start customer-service-backend

# æˆ–è€…ç›´æ¥å¯åŠ¨
npm run prod:server
```

### ç‰ˆæœ¬å›æ»š

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼š

1. åœæ­¢å½“å‰æœåŠ¡
2. æ¢å¤å¤‡ä»½çš„ä»£ç æ–‡ä»¶
3. æ¢å¤å¤‡ä»½çš„æ•°æ®åº“ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
4. é‡æ–°å¯åŠ¨æœåŠ¡

## ğŸ“Š æ€§èƒ½ç›‘æ§

### ç³»ç»Ÿç›‘æ§

#### ä½¿ç”¨ PM2 ç›‘æ§
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs customer-service-backend

# æŸ¥çœ‹ç›‘æ§é¢æ¿
pm2 monit
```

#### ç³»ç»Ÿèµ„æºç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
free -h
```

### æ—¥å¿—ç®¡ç†

#### æ—¥å¿—ä½ç½®
- åº”ç”¨æ—¥å¿—ï¼š`logs/` ç›®å½•
- æ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šMySQL é…ç½®ä¸­å¯ç”¨
- ç³»ç»Ÿæ—¥å¿—ï¼šæ“ä½œç³»ç»Ÿæ—¥å¿—ç›®å½•

#### æ—¥å¿—è½®è½¬
```bash
# é…ç½® logrotate
sudo vim /etc/logrotate.d/customer-service

# ç¤ºä¾‹é…ç½®
/path/to/customer-service/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### æ— æ³•è¿æ¥æ•°æ®åº“
1. æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦è¿è¡Œï¼š
```bash
sudo systemctl status mysql
```

2. æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†æ•°æ®åº“ç«¯å£

#### å¯åŠ¨å¤±è´¥
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š
```bash
# å¦‚æœä½¿ç”¨ PM2
pm2 logs customer-service-backend

# æˆ–è€…æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f logs/error.log
```

2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š
```bash
netstat -tlnp | grep :3001
```

#### æ€§èƒ½é—®é¢˜
1. æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ç´¢å¼•
3. è€ƒè™‘å¢åŠ æœåŠ¡å™¨èµ„æºé…ç½®

### ç´§æ€¥æ¢å¤

#### æ•°æ®åº“æ¢å¤
```bash
# ä»å¤‡ä»½æ¢å¤æ•°æ®åº“
mysql -u cs_user -pstrong_password_here customer_service_db < backup_file.sql
```

#### æœåŠ¡é‡å¯
```bash
# é‡å¯æœåŠ¡
pm2 restart customer-service-backend
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. é”™è¯¯æ—¥å¿—å†…å®¹
2. ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
3. éƒ¨ç½²æ­¥éª¤å’Œé…ç½®
4. é—®é¢˜å‘ç”Ÿçš„å…·ä½“åœºæ™¯
